Инструкция для Frontend-разработчиков (PM_Meetup)

## 1. Требования
Единственное, что нужно установить на компьютер:
*   **Docker Desktop** (https://www.docker.com/products/docker-desktop/)

*(Python и Node.js находятся внутри контейнеров)*

> Весь процесс разработки будет проводится через контейнеризацию Docker

---

## 2. Старт

**Перед первым запуском:**

1. В корне проекта создать файл **`.env`** (скопировать из `.env.example`). В `.env` обязательно совпадают пароли для БД: **`POSTGRES_PASSWORD`** и **`DB_PASSWORD`** (одно и то же значение). Иначе контейнер backend будет падать при старте.
2. В корне проекта должна быть папка **`static`** (пустая) — иначе backend выведет предупреждение (на работу не влияет).

**Фронту не нужно создавать миграции** — все файлы миграций уже есть в репозитории. Нужно только применить их и один раз создать суперпользователя для админки.

```bash
# 1. Клонировать репозиторий
git clone <URL_репозитория>
cd pm_meetup

# 2. Создать .env из шаблона (если ещё нет) и проверить, что POSTGRES_PASSWORD = DB_PASSWORD
cp .env.example .env
# Отредактировать .env при необходимости

# 3. Запустить всё (Backend + Frontend + DB)
docker-compose up -d

# 4. Подождать 10–15 секунд, проверить, что backend запущен
docker-compose ps
# Контейнер web должен быть в статусе "Up". Если "Restarting" — см. раздел "Типичные проблемы" ниже.

# 5. Применить миграции (схема БД уже в репо — только применить)
docker-compose exec web python manage.py migrate

# 6. Создать суперпользователя для входа в админку (обязательно при первом запуске)
docker-compose exec web python manage.py createsuperuser
```

---
## 3. Создание суперпользователя (обязательно при первом запуске)

Без суперпользователя нельзя зайти в админку (`/admin/`) и получить API-ключ. Выполнить **один раз** после первого `migrate`:

```bash
docker-compose exec web python manage.py createsuperuser
```

Вход в админку — по **email** и паролю (логина отдельно нет). При создании запрашиваются:

- **Email** (обязательно)
- **Имя**
- **Фамилия**
- **Пароль** и повтор пароля (минимум 8 символов, не совпадать с email)

## 4. Проверка работы

| Сервис             | URL                               | Описание                              |
| ------------------ | --------------------------------- | ------------------------------------- |
| **React Frontend** | `http://localhost:3000`           | Ваше приложение                       |
| **Django Admin**   | `http://localhost:8000/admin/`    | Админка (вход по email и паролю из createsuperuser) |
| **Swagger API**    | `http://localhost:8000/api/docs/` | Документация API                      |

---

## 6. Основные команды

| Задача                       | Команда                                                            |
| ---------------------------- | ------------------------------------------------------------------ |
| **Остановить проект**        | `docker-compose down`                                              |
| **Перезапустить**            | `docker-compose restart`                                           |
| **Посмотреть логи**          | `docker-compose logs -f`                                           |
| **Логи только фронта**       | `docker-compose logs -f frontend`                                   |
| **Логи только бэка**         | `docker-compose logs -f web`                                       |
| **Применить миграции**       | `docker-compose exec web python manage.py migrate`                 |
| **Создать суперпользователя**| `docker-compose exec web python manage.py createsuperuser`         |
| **Собрать статику**          | `docker-compose exec web python manage.py collectstatic --noinput` |

> **Фронту:** миграции только **применяются** (`migrate`). Команду `makemigrations` использует backend-разработчик; после обновления кода достаточно сделать `git pull` и снова `migrate`.

---

## 7. Если что-то сломалось

```bash
# 1. Остановить всё
docker-compose down

# 2. Очистить кэш (если были ошибки сборки)
docker-compose build --no-cache

# 3. Запустить заново
docker-compose up -d
```

---

## 8. Типичные проблемы при развёртывании (Backend и API)

Фронт зависит от backend: если контейнер **web** не запущен или постоянно перезапускается, API не отвечает и фронт не сможет с ним работать. Ниже — частые причины и что делать.

### Контейнер web в статусе "Restarting", команды `exec` не выполняются

**Причина:** backend падает при старте (чаще всего при попытке подключиться к БД или применить миграции).

**Что сделать:**

1. Посмотреть логи backend:
   ```bash
   docker-compose logs web --tail=100
   ```
2. По тексту ошибки:
   - **`password authentication failed for user "postgres"`** — не совпадают пароли БД. В `.env` должны быть одинаковые значения: `POSTGRES_PASSWORD=...` и `DB_PASSWORD=...`. После исправления: `docker-compose down -v` (удалит данные БД!), затем `docker-compose up -d`. Через 10–15 сек снова `migrate` и при необходимости `createsuperuser`.
   - **`Dependency on app with no migrations: users`** или **`BadMigrationError`** — в репозитории не хватает файлов миграций. Нужно обновить код (`git pull`), убедиться, что все миграции в репо, затем снова `docker-compose up -d` и `migrate`.

### API не отвечает (502, connection refused, CORS)

- Убедиться, что контейнер **web** в статусе **Up**: `docker-compose ps`.
- Если **Restarting** — действовать по пункту выше (логи `web`, пароли БД, миграции).
- Фронт должен ходить на тот же хост/порт, где поднят backend (в dev обычно `http://localhost:8000`). Проверить в настройках фронта (переменные окружения / .env).

### После первого клона или сброса БД

Порядок действий:

1. Создать `.env` из `.env.example`, проверить `POSTGRES_PASSWORD` и `DB_PASSWORD`.
2. `docker-compose up -d`.
3. Подождать 10–15 сек, проверить `docker-compose ps` (web — Up).
4. Применить миграции: `docker-compose exec web python manage.py migrate`.
5. Создать суперпользователя: `docker-compose exec web python manage.py createsuperuser`.
6. Открыть фронт и API по URL из таблицы «Проверка работы».

Файлы миграций уже в репозитории; фронту нужно только выполнить `migrate` и один раз `createsuperuser`.

---

## 9. Установка зависимостей через Docker

### Команда для установки зависимостей

```
# В корне проекта PM_Meetup
docker-compose exec frontend npm install <название-пакета>
```

### После установки

1. **Пакет устанавливается** внутри контейнера `frontend`
2. **`package.json` обновляется** 
3. **Контейнер автоматически перезапускается** и подхватывает новый пакет
4. **Коммитим** изменённый `package.json` в Git

## 10. API и доступы

*   **API доступно только с ключом** (кроме Swagger и админки).
*   **Получить ключ:** Зайти в админку → раздел "API-ключи" → Создать.
*   **Использовать ключ:**
    *   В заголовке: `X-API-KEY: ваш_ключ`
    *   Или в URL: `?key=ваш_ключ`

